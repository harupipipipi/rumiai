# AIレスポンス生成Flow（サンプル）
# ecosystem/flows/ai_response.flow.yaml

flow_id: ai_response
inputs:
  user_input: string
  context: object
outputs:
  response: string

phases:
  - prepare
  - generate
  - postprocess

defaults:
  fail_soft: true
  on_missing_step: skip

steps:
  - id: load_context
    phase: prepare
    priority: 10
    type: handler
    input:
      handler: "kernel:ctx.get"
      args:
        key: "context"
        default: {}
    output: context

  - id: generate_response
    phase: generate
    priority: 50
    type: python_file_call
    owner_pack: ai_client
    file: blocks/generate.py
    input:
      user_input: "${ctx.user_input}"
      context: "${ctx.context}"
    output: ai_output

  - id: format_output
    phase: postprocess
    priority: 10
    type: set
    input:
      key: response
      value: "${ctx.ai_output.text}"
