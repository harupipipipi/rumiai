================================================================================
                    AI PROFILE JSON SPECIFICATION v2.0
                        ai_profile_json_rule.txt
================================================================================

このファイルは、ai_client/<provider>/ai_profile/ 配下に配置する
モデルプロファイルJSONの公式仕様を定義します。

================================================================================
1. 概要
================================================================================

各AIモデルのプロファイルは、標準化されたJSON形式で記述します。
この仕様に従うことで、システムが自動的にモデルを認識・利用できます。

【配置場所】
- ai_client/<provider>/ai_profile/<model-id>.json
- ai_client/<provider>/ai_profile/<category>/<model-id>.json（再帰探索対応）

【ファイル命名規則】
- ファイル名: `<model-id>.json`
- model-id は `basic_info.id` と一致させること
- 小文字、ハイフン、数字、ピリオドのみ使用
- 例: gemini-2.5-pro.json, gpt-4-turbo.json, claude-3-opus.json

================================================================================
2. スキーマ構造（公式サポート項目）
================================================================================

以下の全項目がプロジェクトとして「公式にサポートする項目」です。
ただし「公式にサポート＝必ず全プロバイダーが実装」ではありません。
モデル/プロバイダーが対応していない場合は supported=false / 情報欠落でも可。

--------------------------------------------------------------------------------
2.1 basic_info（必須）
--------------------------------------------------------------------------------

{
  "basic_info": {
    "id": "string",                    // 必須: ユニークなモデルID（ファイル名と一致）
    "uuid": "string",                  // 推奨: UUID v4形式。未記載時はdeterministic生成
    "name": "string",                  // 必須: 表示名
    "product": "string",               // 任意: プロダクト名（例: "Gemini", "GPT", "Claude", "Grok"）
    "description": "string",           // 必須: モデルの説明
    "provider": "string",              // 必須: プロバイダー名（フォルダ名と一致）
    "version": "string",               // 任意: モデルバージョン
    "release_date": "YYYY-MM-DD",      // 任意: リリース日
    "deprecation_date": "YYYY-MM-DD",  // 任意: 非推奨予定日
    "status": "string",                // 任意: "active" | "beta" | "deprecated" | "preview"
    "created": 1234567890              // 任意: UNIXタイムスタンプ
  }
}

【product フィールドについて】
- プロダクト名/ブランド名を記載（例: "Gemini", "GPT", "Claude", "Grok", "Llama"）
- 未記載の場合、システムはmodel_idから推測を試みる（例: "gemini-2.5-flash" → "Gemini"）
- 同一プロダクト内のモデルをグループ化するために使用
- 大文字小文字を区別する（"Gemini" と "gemini" は別扱い）

【UUID生成ルール】
- uuid未記載の場合、システムはUUIDv5で deterministic に生成する
- 名前空間: "6ba7b810-9dad-11d1-80b4-00c04fd430c8" (DNS namespace)
- 名前: "<provider>:<model_id>"
- 例: UUIDv5(DNS, "gemini:gemini-2.5-pro") -> 固定のUUID

--------------------------------------------------------------------------------
2.2 capabilities（必須）
--------------------------------------------------------------------------------

{
  "capabilities": {
    "context_length": 0,               // 必須: 最大コンテキスト長（トークン）
    "max_completion_tokens": 0,        // 必須: 最大出力トークン数
    "supported_parameters": [          // 必須: サポートするパラメータ名リスト
      "temperature",
      "top_p",
      "max_tokens",
      "stop",
      "tools",
      "tool_choice"
    ],
    "default_parameters": {            // 任意: デフォルトパラメータ値
      "temperature": 0.7
    }
  }
}

--------------------------------------------------------------------------------
2.3 parameters（公式パラメータ定義）
--------------------------------------------------------------------------------

数値パラメータは min/max/default の3つを必須で持つ。

{
  "parameters": {
    "temperature": {
      "type": "number",
      "description": "生成のランダム性を制御",
      "min": 0.0,                      // 必須: 最小値
      "max": 2.0,                      // 必須: 最大値
      "default": 1.0,                  // 必須: デフォルト値
      "step": 0.1                      // 任意: UI用ステップ値
    },
    "top_p": {
      "type": "number",
      "description": "累積確率によるサンプリング",
      "min": 0.0,
      "max": 1.0,
      "default": 1.0
    },
    "top_k": {
      "type": "integer",
      "description": "上位K個からサンプリング",
      "min": 1,
      "max": 100,
      "default": 40
    },
    "max_tokens": {
      "type": "integer",
      "description": "最大出力トークン数",
      "min": 1,
      "max": 65536,
      "default": 4096
    },
    "presence_penalty": {
      "type": "number",
      "description": "既出トークンへのペナルティ",
      "min": -2.0,
      "max": 2.0,
      "default": 0.0
    },
    "frequency_penalty": {
      "type": "number",
      "description": "頻出トークンへのペナルティ",
      "min": -2.0,
      "max": 2.0,
      "default": 0.0
    },
    "seed": {
      "type": "integer",
      "description": "再現性のためのシード値",
      "min": 0,
      "max": 9999999999,
      "default": null
    },
    "stop": {
      "type": "array",
      "description": "停止シーケンス",
      "items": {"type": "string"},
      "max_items": 4,
      "default": []
    },
    "response_format": {
      "type": "object",
      "description": "レスポンス形式指定",
      "options": ["text", "json_object", "json_schema"],
      "default": "text"
    }
  }
}

--------------------------------------------------------------------------------
2.4 features（必須）
--------------------------------------------------------------------------------

{
  "features": {
    "supports_function_calling": false,  // 必須: Function Calling対応
    "supports_tool_use": false,          // 必須: Tool Use対応（概念的に同等だが別API）
    "supports_streaming": false,         // 必須: ストリーミング対応
    "supports_reasoning": false,         // 必須: 推論/思考機能対応
    "supports_vision": false,            // 任意: 画像入力対応
    "supports_audio_input": false,       // 任意: 音声入力対応
    "supports_audio_output": false,      // 任意: 音声出力対応
    "supports_video": false,             // 任意: 動画入力対応
    "supports_file_upload": false,       // 任意: ファイルアップロード対応
    "supports_code_execution": false,    // 任意: コード実行対応
    "supports_web_search": false,        // 任意: Web検索対応
    "supports_system_messages": true,    // 任意: システムメッセージ対応
    "supports_json_mode": false,         // 任意: JSONモード対応
    "supports_logprobs": false,          // 任意: logprobs対応
    "is_multimodal": false,              // 必須: マルチモーダル対応
    "input_modalities": ["text"],        // 必須: 入力モダリティ
    "output_modalities": ["text"]        // 必須: 出力モダリティ
  }
}

【モダリティ値】
- text, image, audio, video, file, code

【Function Calling vs Tool Use】
- 両者は概念的に類似するが、プロバイダーによりAPI名が異なる
- 公式として「両方の概念を認識」し、どちらかがtrueなら機能として利用可能
- プロバイダー実装がFunction Calling APIのみでも、Tool Use概念として表現可能

--------------------------------------------------------------------------------
2.5 tiers（tierシステム）
--------------------------------------------------------------------------------

同一モデル内でtierにより制約が変わる場合に使用。

{
  "tiers": {
    "default_tier": "standard",          // デフォルトtier名
    "available_tiers": ["free", "standard", "premium"],
    "tier_details": {
      "free": {
        "display_name": "Free Tier",
        "context_length": 32768,
        "max_completion_tokens": 4096,
        "rate_limit_rpm": 10,
        "rate_limit_tpm": 100000,
        "daily_limit": 100,
        "pricing": {
          "prompt_per_1m": 0,
          "completion_per_1m": 0
        }
      },
      "standard": {
        "display_name": "Standard Tier",
        "context_length": 131072,
        "max_completion_tokens": 8192,
        "rate_limit_rpm": 100,
        "rate_limit_tpm": 1000000,
        "pricing": {
          "prompt_per_1m": 0.075,
          "completion_per_1m": 0.30
        }
      },
      "premium": {
        "display_name": "Premium Tier",
        "context_length": 1048576,
        "max_completion_tokens": 65536,
        "rate_limit_rpm": 1000,
        "rate_limit_tpm": 10000000,
        "pricing": {
          "prompt_per_1m": 0.15,
          "completion_per_1m": 0.60
        }
      }
    }
  }
}

【tier適用ルール】
- invoke時に api_tier を指定可能
- 未指定時は default_tier を使用
- tier_details 内の値が capabilities を上書き

--------------------------------------------------------------------------------
2.6 pricing（料金情報）
--------------------------------------------------------------------------------

{
  "pricing": {
    "currency": "USD",
    "prompt_per_1m_tokens": 0.00125,     // 入力100万トークンあたり
    "completion_per_1m_tokens": 0.005,   // 出力100万トークンあたり
    "image_per_image": 0.00258,          // 画像1枚あたり
    "audio_per_minute": 0.006,           // 音声1分あたり
    "video_per_minute": 0.01,            // 動画1分あたり
    "cached_prompt_per_1m": 0.0003125,   // キャッシュ入力
    "reasoning_per_1m": 0.0,             // 推論トークン（別料金の場合）
    "request_per_call": 0.0,             // リクエストあたり固定費
    "notes": "Pricing as of 2025-01"
  }
}

--------------------------------------------------------------------------------
2.7 reasoning（推論/思考機能）
--------------------------------------------------------------------------------

{
  "reasoning": {
    "supported": true,
    "default_enabled": false,
    "budget_parameter": "thinking_budget",  // パラメータ名
    "min_budget": 0,
    "max_budget": 65536,
    "default_budget": 8192,
    "budget_unit": "tokens",
    "separate_pricing": false,              // 別料金かどうか
    "visible_in_response": true             // 思考過程がレスポンスに含まれるか
  }
}

--------------------------------------------------------------------------------
2.8 related_models（関連モデル）
--------------------------------------------------------------------------------

{
  "related_models": {
    "thinking_variant": "gemini-2.5-pro-thinking",
    "lite_variant": "gemini-2.5-flash-lite",
    "cheap_variant": "gemini-2.5-flash",
    "fast_variant": "gemini-2.5-flash",
    "predecessor": "gemini-2.0-pro",
    "successor": null,
    "fine_tuned_base": null,
    "aliases": ["gemini-pro", "gemini-2.5"]
  }
}

--------------------------------------------------------------------------------
2.9 limitations（制限事項）
--------------------------------------------------------------------------------

{
  "limitations": {
    "rate_limit_rpm": 60,                // リクエスト/分
    "rate_limit_tpm": 1000000,           // トークン/分
    "rate_limit_rpd": 10000,             // リクエスト/日
    "max_images_per_request": 16,
    "max_audio_length_seconds": 600,
    "max_video_length_seconds": 300,
    "max_file_size_mb": 100,
    "supported_image_formats": ["png", "jpeg", "gif", "webp"],
    "supported_audio_formats": ["mp3", "wav", "flac"],
    "supported_video_formats": ["mp4", "webm"],
    "geographic_restrictions": [],
    "content_restrictions": []
  }
}

--------------------------------------------------------------------------------
2.10 provider_specific（プロバイダー固有設定）
--------------------------------------------------------------------------------

{
  "provider_specific": {
    "api_model_name": "models/gemini-2.5-pro",  // 実際のAPI呼び出し時のモデル名
    "api_version": "v1",
    "endpoint_override": null,
    "requires_api_key_env": "GEMINI_API_KEY",
    "safety_settings_available": true,
    "grounding_available": true,
    "custom_headers": {},
    "additional_config": {}
  }
}

--------------------------------------------------------------------------------
2.11 ui_schema（UIスキーマ）
--------------------------------------------------------------------------------

将来のフロントエンド描画用。バックエンドで保持し、APIで公開。

{
  "ui_schema": {
    "category": "General Purpose",
    "tags": ["fast", "multimodal", "reasoning"],
    "icon": "gemini-icon.svg",
    "color": "#4285F4",
    "recommended_for": ["chat", "coding", "analysis"],
    "not_recommended_for": ["image_generation"],
    "advanced_parameters": ["top_k", "presence_penalty"],
    "hidden_parameters": ["seed"],
    "parameter_groups": {
      "basic": ["temperature", "max_tokens"],
      "sampling": ["top_p", "top_k"],
      "penalties": ["presence_penalty", "frequency_penalty"]
    }
  }
}

================================================================================
3. 完全なプロファイル例
================================================================================

{
  "basic_info": {
    "id": "gemini-2.5-flash",
    "uuid": "c9a2d1e3-4f5b-6789-0abc-def123456789",
    "name": "Google: Gemini 2.5 Flash",
    "product": "Gemini",
    "description": "高速で効率的な汎用モデル。マルチモーダル対応。",
    "provider": "gemini",
    "version": "2.5",
    "release_date": "2025-01-01",
    "status": "active",
    "created": 1750169544
  },
  "capabilities": {
    "context_length": 1048576,
    "max_completion_tokens": 8192,
    "supported_parameters": [
      "temperature", "top_p", "top_k", "max_tokens",
      "stop", "tools", "tool_choice", "response_format"
    ],
    "default_parameters": {
      "temperature": 0.7,
      "top_p": 0.95
    }
  },
  "parameters": {
    "temperature": {
      "type": "number",
      "description": "生成のランダム性を制御",
      "min": 0.0,
      "max": 2.0,
      "default": 0.7,
      "step": 0.1
    },
    "top_p": {
      "type": "number",
      "description": "累積確率によるサンプリング",
      "min": 0.0,
      "max": 1.0,
      "default": 0.95
    },
    "top_k": {
      "type": "integer",
      "description": "上位K個からサンプリング",
      "min": 1,
      "max": 100,
      "default": 40
    },
    "max_tokens": {
      "type": "integer",
      "description": "最大出力トークン数",
      "min": 1,
      "max": 8192,
      "default": 4096
    }
  },
  "features": {
    "supports_function_calling": true,
    "supports_tool_use": true,
    "supports_streaming": true,
    "supports_reasoning": true,
    "supports_vision": true,
    "supports_audio_input": true,
    "supports_video": true,
    "supports_file_upload": true,
    "supports_system_messages": false,
    "supports_json_mode": true,
    "is_multimodal": true,
    "input_modalities": ["text", "image", "audio", "video", "file"],
    "output_modalities": ["text"]
  },
  "tiers": {
    "default_tier": "standard",
    "available_tiers": ["free", "standard"],
    "tier_details": {
      "free": {
        "display_name": "Free Tier",
        "context_length": 1048576,
        "max_completion_tokens": 8192,
        "rate_limit_rpm": 15,
        "rate_limit_tpm": 1000000,
        "daily_limit": 1500,
        "pricing": {
          "prompt_per_1m": 0,
          "completion_per_1m": 0
        }
      },
      "standard": {
        "display_name": "Standard Tier (Pay-as-you-go)",
        "context_length": 1048576,
        "max_completion_tokens": 8192,
        "rate_limit_rpm": 2000,
        "rate_limit_tpm": 4000000,
        "pricing": {
          "prompt_per_1m": 0.075,
          "completion_per_1m": 0.30
        }
      }
    }
  },
  "pricing": {
    "currency": "USD",
    "prompt_per_1m_tokens": 0.075,
    "completion_per_1m_tokens": 0.30,
    "image_per_image": 0.00258,
    "cached_prompt_per_1m": 0.01875
  },
  "reasoning": {
    "supported": true,
    "default_enabled": false,
    "budget_parameter": "thinking_budget",
    "min_budget": 0,
    "max_budget": 24576,
    "default_budget": 8192,
    "budget_unit": "tokens",
    "separate_pricing": false,
    "visible_in_response": true
  },
  "related_models": {
    "premium_variant": "gemini-2.5-pro",
    "lite_variant": "gemini-2.5-flash-lite",
    "predecessor": "gemini-2.0-flash"
  },
  "limitations": {
    "rate_limit_rpm": 2000,
    "rate_limit_tpm": 4000000,
    "max_images_per_request": 16,
    "max_audio_length_seconds": 600,
    "max_video_length_seconds": 300
  },
  "provider_specific": {
    "api_model_name": "gemini-2.5-flash",
    "requires_api_key_env": "GEMINI_API_KEY",
    "safety_settings_available": true,
    "grounding_available": true
  },
  "ui_schema": {
    "category": "General Purpose",
    "tags": ["fast", "multimodal", "efficient", "reasoning"],
    "recommended_for": ["chat", "coding", "analysis", "creative"],
    "advanced_parameters": ["top_k"],
    "parameter_groups": {
      "basic": ["temperature", "max_tokens"],
      "sampling": ["top_p", "top_k"]
    }
  }
}

================================================================================
4. 必須フィールドまとめ
================================================================================

【必須セクション】
- basic_info: id, name, description, provider
- capabilities: context_length, max_completion_tokens, supported_parameters
- features: supports_function_calling, supports_tool_use, supports_streaming,
            supports_reasoning, is_multimodal, input_modalities, output_modalities

【推奨セクション】
- parameters: 数値パラメータは min/max/default 必須
- tiers: 複数tierがある場合
- pricing: 料金情報
- reasoning: 推論機能がある場合

【任意セクション】
- related_models, limitations, provider_specific, ui_schema

================================================================================
5. バリデーションルール
================================================================================

1. basic_info.id とファイル名（拡張子除く）が一致すること
2. basic_info.provider と配置フォルダ名が一致すること
3. parameters内の数値型は min, max, default を持つこと
4. features.is_multimodal が true なら input_modalities に text 以外を含むこと
5. tiers がある場合、default_tier が available_tiers に含まれること
6. JSONの構文が正しいこと

================================================================================
6. 再帰探索とファイル配置
================================================================================

ai_profile/ 配下はフラット配置・サブディレクトリ配置の両方をサポート：

ai_client/gemini/ai_profile/
├── gemini-2.5-pro.json           # フラット配置
├── gemini-2.5-flash.json
├── experimental/                  # サブディレクトリ
│   └── gemini-3.0-preview.json
└── legacy/
    └── gemini-1.5-pro.json

アンダースコアで始まるファイル/ディレクトリは無視される：
- _template.json（無視）
- _drafts/（無視）

================================================================================
7. プロダクト名の自動推測
================================================================================

basic_info.product が未記載の場合、システムは model_id から推測を試みる。

【推測パターン】
- gemini-* → "Gemini"
- gpt-4*, gpt-3* → "GPT"
- o1-*, o3-* → "o1", "o3"
- claude-* → "Claude"
- grok-* → "Grok"
- llama-* → "Llama"
- mistral-* → "Mistral"
- mixtral-* → "Mixtral"
- command-* → "Command"
- deepseek-* → "DeepSeek"
- qwen-* → "Qwen"

パターンに一致しない場合、model_idの最初の部分を使用：
- some-model-v1 → "Some"

================================================================================
8. 変更履歴
================================================================================

### v2.0 (2025-XX-XX)
- tier システムの追加
- parameters セクションに min/max/default 必須化
- supports_tool_use の追加（function_calling と並列）
- related_models の追加
- ui_schema の追加
- 再帰探索対応
- UUID deterministic 生成ルールの明文化
- product フィールドの追加（プロダクト名/ブランド名）
- プロダクト名自動推測機能の追加

### v1.0 (2025-01-XX)
- 初版リリース

================================================================================